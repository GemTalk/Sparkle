Version history of this document:

2021-01-15 -- Can now run as an unprivileged user, update Pharo build number
2020-12-29 -- Replace playground instructions with Sparkle Launcher instructions
2020-12-28 -- initial version

How to load and run Sparkle

The parts of Sparkle that are working as of this moment (primarily the inspector) are able to run in GemStone 3.6.0. Once the debugger starts becoming functional, GemStone 3.6.1 will be required. These instructions assume a GemStone 3.6.0 server on Linux, and a Pharo 9 client on Windows.

----

Prerequisites: 
 * A running GemStone 3.6.0 stone that you can experiment on
 * A recent Windows VM and image for 64-bit Pharo 9. These instructions were written using image build 1029 and a 90-x64 VM (not a 90-x64-headless VM) that appears to have been built on 2020-10-13.
 
1) Get the software from GitHub
  On *both* the Windows machine and the Linux machine:
    * Create or choose a directory for Git clones, and set the environment variable ROWAN_PROJECTS_HOME to point at that directory.
    * Clone https://github.com/GemTalk/RemoteServiceReplication.git to $ROWAN_PROJECTS_HOME/RemoteServiceReplication
    * Clone https://github.com/GemTalk/Sparkle.git to $ROWAN_PROJECTS_HOME/Sparkle
  In both cases, you will be on the default branch named "development."
  You will use the Windows clone to load into Pharo, and the Linux clone to load into GemStone.
  
2) Install to Pharo
  Lauch Pharo 9, making sure that ROWAN_PROJECTS_HOME is defined in the environment from which the VM is launched.
  In Pharo:
    * In the system settings browser, choose an Appearance --> UserInterfaceTheme of "Pharo Dark." Use with the light theme is not recommended at this time, as Sparkle is not yet themed and some colors make things hard to read in the light theme.
    * Open Iceberg
      * In the Iceberg repositories list, click Add.
      * Choose "Import from existing clone."
      * Click the folder icon to open a file selection dialog.
      * Choose %ROWAN_PROJECTS_HOME%\Sparkle and click OK.
      * Click OK in the "Import from existing clone" dialog. Sparkle should appear in the Iceberg repository list.
      * Right-click on Sparkle in that list, and choose Metacello->Install baseline of Sparkle (default).
    Sparkle will load the RemoteServiceReplication and Sparkle packages.
    * Save the image.

3) Install to GemStone
  In a shell which has $GEMSTONE configured for the stone you want to use, and which has $GEMSTONE/bin in its PATH:
  * cd $ROWAN_PROJECTS_HOME/Sparkle/src-gs
  * Edit loginSystemUser.topaz to have the correct stone name and SystemUser password
  * ./bootstrapSparkle.sh
  The result of the "errorcount" at the end of the output should be 0.
  
4) Launch a gem that will listen for a connection from Pharo
  **Warning** This step will launch a gem that will listen for a connection on port 29299. At present, there is *no* security on that port.
  * Edit login.topaz to have the correct stone name, user name, and password.
    You can use an unprivileged user for this, SystemUser is only required for
    installation.
  * ./server.sh
  You should see a "Starting to listen" message.
  
5) Connect from Pharo
  * Open the Sparkle Launcher from the Tools menu.
  * Enter the name or IP address of the Linux gem in the "Host" field.
  * Click the "Connect" button. 
  An explorer window will open.
  
6) When done, click Disconnect in the launcher window. This will close any open explorer windows.
